"""GUI launcher for the project."""

from __future__ import annotations

import platform
import sys
from importlib.metadata import Distribution

from {{github_repo_name}}.config import PROJECT_NAME
from {{github_repo_name}}.logging_setup import logger


class GuiDisplayError(RuntimeError):
    """Raised when the GUI window cannot be displayed."""


def build_info_message() -> str:
    """Return a short application information message for display."""
    distribution = Distribution.from_name(PROJECT_NAME)
    python_version = platform.python_version()
    python_implementation = platform.python_implementation()
    system_name = platform.system()
    return (
        f"{PROJECT_NAME}\n"
        f"Version: {distribution.version}\n"
        f"Python: {python_version} ({python_implementation})\n"
        f"Platform: {system_name}"
    )


def _display_message(message: str) -> None:
    """Show the information message in a small Tkinter dialog."""
    try:
        import tkinter as tk
        from tkinter import TclError, messagebox
    except ImportError as exc:
        msg = "Tkinter is not available."
        raise GuiDisplayError(msg) from exc

    root = tk.Tk()
    root.withdraw()
    try:
        messagebox.showinfo(title=f"{PROJECT_NAME} Info", message=message)
    except TclError as exc:
        msg = "Unable to display the GUI window."
        raise GuiDisplayError(msg) from exc
    finally:
        root.destroy()


def main(show_window: bool = True) -> int:
    """Entry point for the GUI script."""
    info_message = build_info_message()
    logger.info("GUI entry point invoked. show_window=%s", show_window)

    if not show_window:
        logger.info("GUI display skipped; writing info to stdout.")
        sys.stdout.write(f"{info_message}\n")
        return 0

    try:
        _display_message(info_message)
    except GuiDisplayError:
        logger.exception("Failed to display GUI window; falling back to stdout.")
        sys.stdout.write(f"{info_message}\n")
        return 1

    logger.info("GUI window displayed successfully.")
    return 0
